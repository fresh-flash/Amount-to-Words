=LET(
    val, num,
    curr_code, UPPER(curr),
    target_lang, UPPER(lang),
    RAW_NUM_STR, SWITCH(target_lang,
        "UA", "|один|два|три|чотири|п'ять|шість|сім|вісім|дев'ять~|одна|дві|три|чотири|п'ять|шість|сім|вісім|дев'ять~десять|одинадцять|дванадцять|тринадцять|чотирнадцять|п'ятнадцять|шістнадцять|сімнадцять|вісімнадцять|дев'ятнадцять~||двадцять|тридцять|сорок|п'ятдесят|шістдесят|сімдесят|вісімдесят|дев'яносто~|сто|двісті|триста|чотириста|п'ятсот|шістьсот|сімсот|вісімсот|дев'ятсот~тисяча|тисячі|тисяч|1~мільйон|мільйони|мільйонів|0~мільярд|мільярди|мільярдів|0~Нуль",
        "RU", "|один|два|три|четыре|пять|шесть|семь|восемь|девять~|одна|две|три|четыре|пять|шесть|семь|восемь|девять~десять|одиннадцать|двенадцать|тринадцать|четырнадцать|пятнадцать|шестнадцать|семнадцать|восемнадцать|девятнадцать~||двадцать|тридцать|сорок|пятьдесят|шестьдесят|семьдесят|восемьдесят|девяносто~|сто|двести|триста|четыреста|пятьсот|шестьсот|семьсот|восемьсот|девятьсот~тысяча|тысячи|тысяч|1~миллион|миллиона|миллионов|0~миллиард|миллиарда|миллиардов|0~Ноль",
        "DE", "|eins|zwei|drei|vier|fünf|sechs|sieben|acht|neun~|eine|zwei|drei|vier|fünf|sechs|sieben|acht|neun~zehn|elf|zwölf|dreizehn|vierzehn|fünfzehn|sechzehn|siebzehn|achtzehn|neunzehn~||zwanzig|dreißig|vierzig|fünfzig|sechzig|siebzig|achtzig|neunzig~|einhundert|zweihundert|dreihundert|vierhundert|fünfhundert|sechshundert|siebenhundert|achthundert|neunhundert~tausend|tausend|tausend|0~Million|Millionen|Millionen|1~Milliarde|Milliarden|Milliarden|1~Null",
        "ES", "|un|dos|tres|cuatro|cinco|seis|siete|ocho|nueve~|una|dos|tres|cuatro|cinco|seis|siete|ocho|nueve~diez|once|doce|trece|catorce|quince|dieciséis|diecisiete|dieciocho|diecinueve~||veinte|treinta|cuarenta|cincuenta|sesenta|setenta|ochenta|noventa~|ciento|doscientos|trescientos|cuatrocientos|quinientos|seiscientos|setecientos|ochocientos|novecientos~mil|mil|mil|0~millón|millones|millones|0~mil millones|mil millones|mil millones|0~Cero",
        "IT", "|uno|due|tre|quattro|cinque|sei|sette|otto|nove~|una|due|tre|quattro|cinque|sei|sette|otto|nove~dieci|undici|dodici|tredici|quattordici|quindici|sedici|diciassette|diciotto|diciannove~||venti|trenta|quaranta|cinquanta|sessanta|settanta|ottanta|novanta~|cento|duecento|trecento|quattrocento|cinquecento|seicento|settecento|ottocento|novecento~mille|mila|mila|1~milione|milioni|milioni|0~miliardo|miliardi|miliardi|0~Zero",
        "FR", "|un|deux|trois|quatre|cinq|six|sept|huit|neuf~|une|deux|trois|quatre|cinq|six|sept|huit|neuf~dix|onze|douze|treize|quatorze|quinze|seize|dix-sept|dix-huit|dix-neuf~||vingt|trente|quarante|cinquante|soixante|septante|huitante|nonante~|cent|deux cents|trois cents|quatre cents|cinq cents|six cents|sept cents|huit cents|neuf cents~mille|mille|mille|1~million|millions|millions|0~milliard|milliards|milliards|0~Zéro",
        "PL", "|jeden|dwa|trzy|cztery|pięć|sześć|siedem|osiem|dziewięć~|jedna|dwie|trzy|cztery|pięć|sześć|siedem|osiem|dziewięć~dziesięć|jedenaście|dwanaście|trzynaście|czternaście|piętnaście|szesnaście|siedemnaście|osiemnaście|dziewiętnaście~||dwadzieścia|trzydzieści|czterdzieści|pięćdziesiąt|sześćdziesiąt|siedemdziesiąt|osiemdziesiąt|dziewięćdziesiąt~|sto|dwieście|trzysta|czterysta|pięćset|sześćset|siedemset|osiemset|dziewięćset~tysiąc|tysiące|tysięcy|1~milion|miliony|milionów|0~miliard|miliardy|miliardów|0~Zero",
        "NL", "|een|twee|drie|vier|vijf|zes|zeven|acht|negen~|een|twee|drie|vier|vijf|zes|zeven|acht|negen~tien|elf|twaalf|dertien|veertien|vijftien|zestien|zeventien|achttien|negentien~||twintig|dertig|veertig|vijftig|zestig|zeventig|tachtig|negentig~|honderd|tweehonderd|driehonderd|vierhonderd|vijfhonderd|zeshonderd|zevenhonderd|achthonderd|negenhonderd~duizend|duizend|duizend|0~miljoen|miljoen|miljoen|0~miljard|miljard|miljard|0~Nul",
        "|One|Two|Three|Four|Five|Six|Seven|Eight|Nine~|One|Two|Three|Four|Five|Six|Seven|Eight|Nine~Ten|Eleven|Twelve|Thirteen|Fourteen|Fifteen|Sixteen|Seventeen|Eighteen|Nineteen~||Twenty|Thirty|Forty|Fifty|Sixty|Seventy|Eighty|Ninety~|One hundred|Two hundred|Three hundred|Four hundred|Five hundred|Six hundred|Seven hundred|Eight hundred|Nine hundred~Thousand|Thousand|Thousand|0~Million|Million|Million|0~Billion|Billion|Billion|0~Zero"
    ),

    RAW_CURR_STR, SWITCH(target_lang,
        "UA", "PLN|злотий|злоті|злотих|1|грош|гроші|грошів|1~UAH|гривня|гривні|гривень|1|копійка|копійки|копійок|1~USD|долар|долари|доларів|0|цент|цента|центів|0~EUR|євро|євро|євро|0|євроцент|євроцента|євроцентів|0~JPY|єна|єни|єн|1|сен|сени|сенів|0~GBP|фунт|фунти|фунтів|0|пенні|пенні|пенні|0~CHF|франк|франки|франків|0|сантим|сантими|сантимів|0~CAD|долар|долари|доларів|0|цент|цента|центів|0~AUD|долар|долари|доларів|0|цент|цента|центів|0~NZD|долар|долари|доларів|0|цент|цента|центів|0~CNY|юань|юані|юанів|0|фень|фені|фенів|0~SGD|долар|долари|доларів|0|цент|цента|центів|0~HKD|долар|долари|доларів|0|цент|цента|центів|0~ZAR|ренд|ренди|рендів|0|цент|цента|центів|0~SEK|крона|крони|крон|1|ере|ере|ере|0~NOK|крона|крони|крон|1|ере|ере|ере|0~MXN|песо|песо|песо|0|сентаво|сентаво|сентаво|0",
        
        "RU", "PLN|злотый|злотых|злотых|1|грош|гроша|грошей|1~UAH|гривна|гривны|гривен|1|копейка|копейки|копеек|1~USD|доллар|доллара|долларов|0|цент|цента|центов|0~EUR|евро|евро|евро|0|евроцент|евроцента|евроцентов|0~JPY|иена|иены|иен|1|сен|сена|сенов|0~GBP|фунт|фунта|фунтов|0|пенни|пенни|пенни|0~CHF|франк|франка|франков|0|сантим|сантима|сантимов|0~CAD|доллар|доллара|долларов|0|цент|цента|центов|0~AUD|доллар|доллара|долларов|0|цент|цента|центов|0~NZD|доллар|доллара|долларов|0|цент|цента|центов|0~CNY|юань|юаня|юаней|0|фэнь|фэня|фэней|0~SGD|доллар|доллара|долларов|0|цент|цента|центов|0~HKD|доллар|доллара|долларов|0|цент|цента|центов|0~ZAR|рэнд|рэнда|рэндов|0|цент|цента|центов|0~SEK|крона|кроны|крон|1|эре|эре|эре|0~NOK|крона|кроны|крон|1|эре|эре|эре|0~MXN|песо|песо|песо|0|сентаво|сентаво|сентаво|0",
        
        "DE", "PLN|Zloty|Zloty|Zloty|1|Grosz|Grosz|Grosz|1~UAH|Hrywnja|Hrywnja|Hrywnja|1|Kopeke|Kopeken|Kopeken|1~USD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~EUR|Euro|Euro|Euro|0|Cent|Cent|Cent|0~JPY|Yen|Yen|Yen|0|Sen|Sen|Sen|0~GBP|Pfund|Pfund|Pfund|0|Penny|Pence|Pence|0~CHF|Franken|Franken|Franken|0|Rappen|Rappen|Rappen|0~CAD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~AUD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~NZD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~CNY|Yuan|Yuan|Yuan|0|Fen|Fen|Fen|0~SGD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~HKD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~ZAR|Rand|Rand|Rand|0|Cent|Cent|Cent|0~SEK|Krone|Kronen|Kronen|1|Öre|Öre|Öre|0~NOK|Krone|Kronen|Kronen|1|Öre|Öre|Öre|0~MXN|Peso|Pesos|Pesos|0|Centavo|Centavos|Centavos|0",
        
        "ES", "PLN|Zloty|Zlotys|Zlotys|1|grosz|groszy|groszy|1~UAH|Grivna|Grivnas|Grivnas|1|kopek|kopeks|kopeks|0~USD|Dólar|Dólares|Dólares|0|centavo|centavos|centavos|0~EUR|Euro|Euros|Euros|0|céntimo|céntimos|céntimos|0~JPY|Yen|Yenes|Yenes|0|sen|sen|sen|0~GBP|Libra|Libras|Libras|1|penique|peniques|peniques|0~CHF|Franco|Francos|Francos|0|céntimo|céntimos|céntimos|0~CAD|Dólar|Dólares|Dólares|0|centavo|centavos|centavos|0~AUD|Dólar|Dólares|Dólares|0|centavo|centavos|centavos|0~NZD|Dólar|Dólares|Dólares|0|centavo|centavos|centavos|0~CNY|Yuan|Yuanes|Yuanes|0|fen|fen|fen|0~SGD|Dólar|Dólares|Dólares|0|centavo|centavos|centavos|0~HKD|Dólar|Dólares|Dólares|0|centavo|centavos|centavos|0~ZAR|Rand|Rands|Rands|0|centavo|centavos|centavos|0~SEK|Corona|Coronas|Coronas|1|öre|öre|öre|0~NOK|Corona|Coronas|Coronas|1|öre|öre|öre|0~MXN|Peso|Pesos|Pesos|0|centavo|centavos|centavos|0",

        "IT", "PLN|Zloty|Zloty|Zloty|1|grosz|groszy|groszy|1~UAH|Grivnia|Grivnie|Grivnie|1|copeco|copechi|copechi|0~USD|Dollaro|Dollari|Dollari|0|cent|cent|cent|0~EUR|Euro|Euro|Euro|0|cent|cent|cent|0~JPY|Yen|Yen|Yen|0|sen|sen|sen|0~GBP|Sterlina|Sterline|Sterline|1|penny|pence|pence|0~CHF|Franco|Franchi|Franchi|0|centesimo|centesimi|centesimi|0~CAD|Dollaro|Dollari|Dollari|0|cent|cent|cent|0~AUD|Dollaro|Dollari|Dollari|0|cent|cent|cent|0~NZD|Dollaro|Dollari|Dollari|0|cent|cent|cent|0~CNY|Yuan|Yuan|Yuan|0|fen|fen|fen|0~SGD|Dollaro|Dollari|Dollari|0|cent|cent|cent|0~HKD|Dollaro|Dollari|Dollari|0|cent|cent|cent|0~ZAR|Rand|Rand|Rand|0|cent|cent|cent|0~SEK|Corona|Corone|Corone|1|ore|ore|ore|0~NOK|Corona|Corone|Corone|1|ore|ore|ore|0~MXN|Peso|Pesos|Pesos|0|centavo|centavos|centavos|0",

        "FR", "PLN|Zloty|Zlotys|Zlotys|1|grosz|groszy|groszy|1~UAH|Hryvnia|Hryvnias|Hryvnias|1|kopeck|kopecks|kopecks|0~USD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~EUR|Euro|Euros|Euros|0|cent|cents|cents|0~JPY|Yen|Yen|Yen|0|sen|sen|sen|0~GBP|Livre|Livres|Livres|1|penny|pence|pence|0~CHF|Franc|Francs|Francs|0|centime|centimes|centimes|0~CAD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~AUD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~NZD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~CNY|Yuan|Yuan|Yuan|0|fen|fen|fen|0~SGD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~HKD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~ZAR|Rand|Rands|Rands|0|cent|cents|cents|0~SEK|Couronne|Couronnes|Couronnes|1|ore|ore|ore|0~NOK|Couronne|Couronnes|Couronnes|1|ore|ore|ore|0~MXN|Peso|Pesos|Pesos|0|centavo|centavos|centavos|0",

        "PL", "PLN|złoty|złote|złotych|1|grosz|grosze|groszy|1~UAH|hrywna|hrywny|hrywien|1|kopiejka|kopiejki|kopiejek|1~USD|dolar|dolary|dolarów|0|cent|centy|centów|0~EUR|euro|euro|euro|0|cent|centy|centów|0~JPY|jen|jeny|jenów|0|sen|seny|senów|0~GBP|funt|funty|funtów|0|pens|pensy|pensów|0~CHF|frank|franki|franków|0|centym|centymy|centymów|0~CAD|dolar|dolary|dolarów|0|cent|centy|centów|0~AUD|dolar|dolary|dolarów|0|cent|centy|centów|0~NZD|dolar|dolary|dolarów|0|cent|centy|centów|0~CNY|juan|juany|juanów|0|fen|feny|fenów|0~SGD|dolar|dolary|dolarów|0|cent|centy|centów|0~HKD|dolar|dolary|dolarów|0|cent|centy|centów|0~ZAR|rand|randy|randów|0|cent|centy|centów|0~SEK|korona|korony|koron|1|ore|ore|ore|0~NOK|korona|korony|koron|1|ore|ore|ore|0~MXN|peso|peso|peso|0|centavo|centavos|centavos|0",

        "NL", "PLN|Zloty|Zloty|Zloty|1|Grosz|Grosz|Grosz|1~UAH|Hryvnia|Hryvnia|Hryvnia|1|Kopeke|Kopeken|Kopeken|1~USD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~EUR|Euro|Euro|Euro|0|Cent|Cent|Cent|0~JPY|Yen|Yen|Yen|0|Sen|Sen|Sen|0~GBP|Pond|Pond|Pond|0|Penny|Pence|Pence|0~CHF|Frank|Frank|Frank|0|Rappen|Rappen|Rappen|0~CAD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~AUD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~NZD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~CNY|Yuan|Yuan|Yuan|0|Fen|Fen|Fen|0~SGD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~HKD|Dollar|Dollar|Dollar|0|Cent|Cent|Cent|0~ZAR|Rand|Rand|Rand|0|Cent|Cent|Cent|0~SEK|Kroon|Kronen|Kronen|1|Öre|Öre|Öre|0~NOK|Kroon|Kronen|Kronen|1|Öre|Öre|Öre|0~MXN|Peso|Peso|Peso|0|Centavo|Centavos|Centavos|0",
        
        "PLN|Zloty|Zlotys|Zlotys|0|grosz|groszy|groszy|0~UAH|Hryvnia|Hryvnias|Hryvnias|0|kopeck|kopecks|kopecks|0~USD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~EUR|Euro|Euros|Euros|0|cent|cents|cents|0~JPY|Yen|Yen|Yen|0|sen|sen|sen|0~GBP|Pound|Pounds|Pounds|0|penny|pence|pence|0~CHF|Franc|Francs|Francs|0|centime|centimes|centimes|0~CAD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~AUD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~NZD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~CNY|Yuan|Yuan|Yuan|0|fen|fen|fen|0~SGD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~HKD|Dollar|Dollars|Dollars|0|cent|cents|cents|0~ZAR|Rand|Rand|Rand|0|cent|cents|cents|0~SEK|Krona|Kronor|Kronor|0|ore|ore|ore|0~NOK|Krone|Kroner|Kroner|0|ore|ore|ore|0~MXN|Peso|Pesos|Pesos|0|centavo|centavos|centavos|0"
    ),

    NUM_GROUPS, TOCOL(SPLIT(RAW_NUM_STR, "~")),
    
    Words_OnesM, TOCOL(SPLIT(INDEX(NUM_GROUPS, 1), "|", FALSE, FALSE)),
    Words_OnesF, TOCOL(SPLIT(INDEX(NUM_GROUPS, 2), "|", FALSE, FALSE)),
    Words_Teens, TOCOL(SPLIT(INDEX(NUM_GROUPS, 3), "|", FALSE, FALSE)),
    Words_Tens,  TOCOL(SPLIT(INDEX(NUM_GROUPS, 4), "|", FALSE, FALSE)),
    Words_Hund,  TOCOL(SPLIT(INDEX(NUM_GROUPS, 5), "|", FALSE, FALSE)),
    Words_Thous, TOCOL(SPLIT(INDEX(NUM_GROUPS, 6), "|", FALSE, FALSE)),
    Words_Mill,  TOCOL(SPLIT(INDEX(NUM_GROUPS, 7), "|", FALSE, FALSE)),
    Words_Bill,  TOCOL(SPLIT(INDEX(NUM_GROUPS, 8), "|", FALSE, FALSE)),
    Words_Dummy, TOCOL(SPLIT("|||0", "|", FALSE, FALSE)),
    Word_Zero,   INDEX(NUM_GROUPS, 9),

    CURR_LIST, TOCOL(SPLIT(RAW_CURR_STR, "~")),
    CURR_FOUND, XLOOKUP("*"&curr_code&"*", CURR_LIST, CURR_LIST, INDEX(CURR_LIST,1), 2),
    DATA_CURR, TOCOL(SPLIT(CURR_FOUND, "|")),
    CurrIsFem, INDEX(DATA_CURR, 5),
    CentIsFem, INDEX(DATA_CURR, 9),

    getDeclension, LAMBDA(n, 
        LET(nn, MOD(ABS(n),100), r, MOD(nn,10),
            IF(OR(target_lang="US", target_lang="UK", target_lang="EN", target_lang="DE", target_lang="NL", target_lang="ES", target_lang="IT", target_lang="FR"), IF(n=1,1,2),
            IF(AND(nn>=11, nn<=19), 3, IF(r=1, 1, IF(AND(r>=2, r<=4), 2, 3))))
        )
    ),

    getTriad, LAMBDA(n, isFem, isThousand,
        LET(
            h, INT(n/100), t, MOD(n,100), d, MOD(n,10),
            txtH, IF(h=0, "", IF(AND(target_lang="ES", h=1, t=0), "cien", INDEX(Words_Hund, h+1))),
            txtTensPart, 
            IF(AND(t>=10, t<=19), INDEX(Words_Teens, t-9),
                IF(t>=20, 
                    LET(
                        tenW, INDEX(Words_Tens, INT(t/10)+1),
                        oneW, IF(d=0, "", INDEX(IF(isFem, Words_OnesF, Words_OnesM), d+1)),
                        IF(OR(target_lang="DE", target_lang="NL"), 
                            LET(connector, IF(target_lang="NL", "en", "und"),
                                IF(d=0, tenW, IF(d=1, IF(target_lang="NL", "een", "ein"), oneW) & connector & tenW)
                            ),
                            IF(target_lang="ES", 
                                IF(d=0, tenW, tenW & " y " & IF(AND(isThousand, d=1), "", oneW)),
                                tenW & " " & oneW 
                            )
                        )
                    ),
                    IF(d=0, "", 
                       IF(AND(target_lang="ES", isThousand, d=1), "", INDEX(IF(isFem, Words_OnesF, Words_OnesM), d+1))
                    )
                )
            ),
            TRIM(txtH & " " & txtTensPart)
        )
    ),

    processPeriod, LAMBDA(v, idx, acc,
        LET(
            currTriad, MOD(INT(v / 10^(3*(idx-1))), 1000),
            periodData, CHOOSE(idx, Words_Dummy, Words_Thous, Words_Mill, Words_Bill),
            isFemPeriod, IF(idx=1, CurrIsFem, IF(idx>1, INDEX(periodData, 4), 0)),
            IF(currTriad = 0, acc,
                LET(
                    triadWords, getTriad(currTriad, isFemPeriod, (idx=2)),
                    decl, getDeclension(currTriad),
                    pName, INDEX(periodData, decl),
                    TRIM(triadWords & " " & pName & " " & acc)
                )
            )
        )
    ),

    calculateText, LAMBDA(n,
        LET(
            valRound, ROUND(n, 2),
            valInt, INT(valRound),
            valCents, ROUND((valRound - valInt) * 100, 0),
            
            strInt, IF(valInt=0, Word_Zero, REDUCE("", {1;2;3;4}, LAMBDA(acc, i, processPeriod(valInt, i, acc)))),
            currWord, INDEX(DATA_CURR, getDeclension(valInt) + 1),
            
            strCents, IF(valCents=0, "", getTriad(valCents, CentIsFem, FALSE)),
            centWord, IF(valCents=0, "", INDEX(DATA_CURR, getDeclension(valCents) + 5)),
            
            fullPhrase, TRIM(strInt & " " & currWord & " " & strCents & " " & centWord),
            UPPER(LEFT(fullPhrase,1)) & MID(fullPhrase, 2, 999)
        )
    ),

    IF(NOT(ISNUMBER(val)), "", IF(val<0, "Error: Negative", calculateText(val)))
)
